{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Christ Academy - {% block title %}{% endblock %}</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link rel="stylesheet" href="{% static 'styles/base/teacher_d.css' %}">

    {% block extra_css %}{% endblock %}
    {% block extra_head %}{% endblock %}
</head>

<body>
    <div class="dashboard-container">

        <nav class="sidebar">
            <div class="sidebar-header">
                <h2>Teacher Portal</h2>
                <div class="school-motto">New Star Academy</div>
            </div>

            <ul class="nav-links">

                <div class="nav-section">Main</div>
                <li>
                    <a href="{% url 'teacher_dashboard' %}" class="active">
                        <i class="bi bi-speedometer2"></i> Dashboard
                    </a>
                </li>

                <div class="nav-section">Teaching</div>
                <li><a href="{% url 'manage_results' %}"><i class="bi bi-journal-text"></i> Manage Results</a></li>
                <li><a href="{% url 'my_students' %}"><i class="bi bi-book"></i> My Subjects</a></li>
                <li><a href="{% url 'my_classes' %}"><i class="bi bi-building"></i> My Classes</a></li>

                <div class="nav-section">Account</div>
                <li><a href="#"><i class="bi bi-person-circle"></i> Profile</a></li>
                <li><a href="{% url 'logout' %}">
                    <i class="bi bi-box-arrow-right"></i> Logout
                </a></li>
            </ul>
        </nav>

        {% block content %}{% endblock %}
    </div>

    <div id="toast" class="toast"></div>

    {% block js %}{% endblock %}

    <script type="module" src="{% static 'scripts/JS/teacher_d.js' %}"></script>

    <!-- <script>
        /*
        All-in-one Multi-Tab Session Manager
        - Paste into your base template (before </body>)
        - Uses BroadcastChannel with localStorage fallback
        - Glassmorphism popup, blur background, draggable, sound, title blink
        */

        (function () {
        // ----- Config -----
        const APP_NAME = document.title || "YourApp";
        const CHANNEL_NAME = "app_session_channel_v1";
        const OWNER_KEY = "app_active_owner_v1";
        const HEARTBEAT_INTERVAL = 2000;
        const HEARTBEAT_TIMEOUT = 5000;

        // ----- Tab identity -----
        const TAB_ID = Math.random().toString(36).slice(2);
        const supportsBroadcast = typeof BroadcastChannel !== "undefined";
        const bc = supportsBroadcast ? new BroadcastChannel(CHANNEL_NAME) : null;

        // ----- State -----
        let isOwner = false;
        let overlayVisible = false;
        let heartbeatTimer = null;
        let blinkInterval = null;
        let soundCtx = null;

        // ----- Utilities -----
        function now() { return Date.now(); }

        function postMessageSafe(msg) {
            try {
            if (supportsBroadcast && bc) {
                bc.postMessage(msg);
            }
            // Always write to localStorage as fallback
            localStorage.setItem(CHANNEL_NAME + "_msg", JSON.stringify({ ...msg, _ts: now() }));
            } catch (e) {
            console.error("Message post failed:", e);
            }
        }

        function playAlertSound() {
            try {
            if (!soundCtx) soundCtx = new (window.AudioContext || window.webkitAudioContext)();
            const ctx = soundCtx;
            const o = ctx.createOscillator();
            const g = ctx.createGain();
            o.type = "sine";
            o.frequency.setValueAtTime(880, ctx.currentTime);
            g.gain.setValueAtTime(0.0001, ctx.currentTime);
            g.gain.exponentialRampToValueAtTime(0.06, ctx.currentTime + 0.02);
            g.gain.exponentialRampToValueAtTime(0.0001, ctx.currentTime + 0.5);
            o.connect(g);
            g.connect(ctx.destination);
            o.start();
            o.stop(ctx.currentTime + 0.55);
            } catch (e) {
            console.warn("Audio alert failed:", e);
            }
        }

        // ----- Title blink -----
        function startTitleBlink() {
            stopTitleBlink();
            let state = false;
            blinkInterval = setInterval(() => {
            document.title = state ? APP_NAME : "⚠️ Active on another tab";
            state = !state;
            }, 1000);
        }
        
        function stopTitleBlink() {
            if (blinkInterval) {
            clearInterval(blinkInterval);
            blinkInterval = null;
            }
            document.title = APP_NAME;
        }

        // ----- Ownership management -----
        function claimOwnership() {
            console.log("[Tab " + TAB_ID + "] Claiming ownership");
            const payload = { type: "CLAIM", tabId: TAB_ID, ts: now() };
            postMessageSafe(payload);
            setOwner(TAB_ID);
            becomeOwner();
        }

        function releaseOwnership() {
            console.log("[Tab " + TAB_ID + "] Releasing ownership");
            const payload = { type: "RELEASE", tabId: TAB_ID, ts: now() };
            postMessageSafe(payload);
            clearOwnerInStorage();
            becomeNonOwner();
        }

        function setOwner(tabId) {
            localStorage.setItem(OWNER_KEY, JSON.stringify({ owner: tabId, ts: now() }));
        }

        function clearOwnerInStorage() {
            localStorage.removeItem(OWNER_KEY);
        }

        function getOwnerFromStorage() {
            const raw = localStorage.getItem(OWNER_KEY);
            if (!raw) return null;
            try { return JSON.parse(raw); } catch (e) { return null; }
        }

        function startHeartbeat() {
            stopHeartbeat();
            heartbeatTimer = setInterval(() => {
            setOwner(TAB_ID);
            postMessageSafe({ type: "HEARTBEAT", tabId: TAB_ID, ts: now() });
            }, HEARTBEAT_INTERVAL);
        }
        
        function stopHeartbeat() {
            if (heartbeatTimer) {
            clearInterval(heartbeatTimer);
            heartbeatTimer = null;
            }
        }

        // ----- UI: create overlay & popup -----
        function createOverlay() {
            if (overlayVisible) return;
            
            console.log("[Tab " + TAB_ID + "] Showing overlay");
            overlayVisible = true;

            if (!document.getElementById("multiTabSessionStyle")) {
            const style = document.createElement("style");
            style.id = "multiTabSessionStyle";
            style.innerHTML = `
        .mt-overlay {
        position: fixed; inset: 0; z-index: 2147483647;
        display: flex; align-items: center; justify-content: center;
        background: rgba(6,10,15,0.55);
        backdrop-filter: blur(6px);
        -webkit-backdrop-filter: blur(6px);
        animation: mt-fade .25s ease both;
        }
        @keyframes mt-fade { from {opacity:0;} to {opacity:1;} }

        .mt-popup {
        width: 92%; max-width: 420px; border-radius: 14px; padding: 22px;
        background: linear-gradient(180deg, rgba(255,255,255,0.66), rgba(255,255,255,0.48));
        box-shadow: 0 10px 40px rgba(2,6,23,0.45);
        color: #07203a;
        transform: translateY(6px) scale(.98);
        animation: mt-pop .28s cubic-bezier(.2,.9,.2,1) forwards;
        backdrop-filter: blur(8px);
        border: 1px solid rgba(255,255,255,0.12);
        position: relative;
        cursor: default;
        }
        @keyframes mt-pop { to { transform: translateY(0) scale(1); opacity:1 } }

        .mt-popup.dark {
        background: linear-gradient(180deg, rgba(20,25,30,0.9), rgba(10,12,14,0.8));
        color: #e6eef8;
        border: 1px solid rgba(255,255,255,0.04);
        box-shadow: 0 12px 50px rgba(0,0,0,0.6);
        }

        .mt-title { font-size: 20px; margin: 0 0 8px; font-weight:700; }
        .mt-desc { font-size: 14px; color: rgba(2,6,23,0.6); margin-bottom: 18px; }
        .dark .mt-desc { color: rgba(230,238,248,0.72); }

        .mt-actions { display:flex; gap:10px; justify-content:center; }
        .mt-btn { 
        padding:10px 14px; border-radius:10px; border:0; font-weight:600; 
        cursor:pointer; transition: all 0.2s ease; 
        }
        .mt-btn:hover { transform: translateY(-1px); }
        .mt-btn:active { transform: translateY(0); }
        .mt-btn.primary { 
        background: linear-gradient(90deg,#2563eb,#4f46e5); 
        color:white; 
        box-shadow:0 6px 20px rgba(37,99,235,0.18); 
        }
        .mt-btn.primary:hover { box-shadow:0 8px 25px rgba(37,99,235,0.25); }
        .mt-btn.ghost { background: transparent; border:1px solid rgba(2,6,23,0.12); color:inherit; }

        .mt-pulse { 
        display:inline-block; width:10px; height:10px; margin-right:8px; 
        border-radius:50%; background: linear-gradient(90deg, #60a5fa, #7c3aed); 
        box-shadow: 0 6px 18px rgba(76,29,149,0.12); 
        animation: mt-pulse 1.6s infinite; vertical-align:middle; 
        }
        @keyframes mt-pulse { 
        0%{ transform:scale(1); opacity:1 } 
        50%{ transform:scale(1.5); opacity:0.6 } 
        100%{ transform:scale(1); opacity:1 } 
        }

        .mt-popup.dragging { cursor:grabbing; }
        .mt-footer-note { margin-top:12px; font-size:12px; color: rgba(2,6,23,0.45); text-align:center; }
        .dark .mt-footer-note { color: rgba(230,238,248,0.52); }
            `;
            document.head.appendChild(style);
            }

            const overlay = document.createElement("div");
            overlay.className = "mt-overlay";
            overlay.id = "mt_overlay";

            const popup = document.createElement("div");
            popup.className = "mt-popup";
            popup.id = "mt_popup";

            const isDark = window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches;
            if (isDark) popup.classList.add("dark");

            popup.innerHTML = `
            <div style="display:flex;align-items:center;gap:12px;justify-content:center;">
                <span class="mt-pulse" aria-hidden="true"></span>
                <div style="text-align:center;">
                <div class="mt-title">This site is active in another tab</div>
                <div class="mt-desc">To avoid conflicts, please use only one active tab. You can continue here or switch to the other tab.</div>
                </div>
            </div>

            <div class="mt-actions" style="margin-top:16px;">
                <button class="mt-btn primary" id="mt_take">Continue here</button>
                <button class="mt-btn ghost" id="mt_ignore">Switch to other tab</button>
            </div>

            <div class="mt-footer-note">Close other tabs to regain full control</div>
            `;

            overlay.appendChild(popup);
            document.body.appendChild(overlay);

            // Button handlers - must be after DOM insertion
            const takeBtn = document.getElementById("mt_take");
            const ignoreBtn = document.getElementById("mt_ignore");

            if (takeBtn) {
            takeBtn.addEventListener("click", function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("[Tab " + TAB_ID + "] User clicked: Continue here");
                playAlertSound();
                claimOwnership();
                removeOverlay();
            });
            }

            if (ignoreBtn) {
            ignoreBtn.addEventListener("click", function(e) {
                e.preventDefault();
                e.stopPropagation();
                console.log("[Tab " + TAB_ID + "] User clicked: Switch to other tab");
                removeOverlay();
                startTitleBlink();
            });
            }

            playAlertSound();
        }

        function removeOverlay() {
            const overlay = document.getElementById("mt_overlay");
            if (overlay) {
            overlay.remove();
            }
            overlayVisible = false;
        }

        // ----- Behaviour -----
        function becomeOwner() {
            console.log("[Tab " + TAB_ID + "] Became owner");
            isOwner = true;
            stopTitleBlink();
            startHeartbeat();
            removeOverlay();
        }

        function becomeNonOwner() {
            console.log("[Tab " + TAB_ID + "] Became non-owner");
            isOwner = false;
            stopHeartbeat();
            createOverlay();
            startTitleBlink();
        }

        // ----- Message handling -----
        function handleMessage(msg) {
            if (!msg || !msg.type) return;
            const { type, tabId, ts } = msg;

            console.log("[Tab " + TAB_ID + "] Received:", type, "from", tabId);

            if (type === "CLAIM" && tabId !== TAB_ID) {
            setOwner(tabId);
            if (isOwner) {
                becomeNonOwner();
            } else {
                createOverlay();
            }
            } 
            else if (type === "RELEASE") {
            const stored = getOwnerFromStorage();
            if (!stored || stored.owner === tabId) {
                clearOwnerInStorage();
                setTimeout(tryAutoClaim, 200);
            }
            } 
            else if (type === "HEARTBEAT" && tabId !== TAB_ID) {
            // Another tab is alive
            const stored = getOwnerFromStorage();
            if (!stored || stored.owner !== tabId) {
                setOwner(tabId);
            }
            } 
            else if (type === "OPENED" && tabId !== TAB_ID) {
            if (!isOwner) createOverlay();
            }
        }

        function tryAutoClaim() {
            const owner = getOwnerFromStorage();
            if (!owner) {
            setTimeout(() => {
                const recheck = getOwnerFromStorage();
                if (!recheck) {
                claimOwnership();
                }
            }, 100 + Math.random() * 300);
            } else {
            if (owner.owner !== TAB_ID) {
                becomeNonOwner();
            } else {
                becomeOwner();
            }
            }
        }

        // ----- Listeners -----
        if (supportsBroadcast && bc) {
            bc.onmessage = (ev) => handleMessage(ev.data);
        }

        window.addEventListener("storage", (e) => {
            if (e.key === CHANNEL_NAME + "_msg" && e.newValue) {
            try {
                const data = JSON.parse(e.newValue);
                if (data && data.type) handleMessage(data);
            } catch (err) {}
            }
            
            if (e.key === OWNER_KEY) {
            const owner = getOwnerFromStorage();
            if (!owner) {
                tryAutoClaim();
            } else {
                if (owner.owner !== TAB_ID) {
                becomeNonOwner();
                } else {
                becomeOwner();
                }
            }
            }
        });

        // Health check
        setInterval(() => {
            const owner = getOwnerFromStorage();
            if (!owner) return;
            const age = now() - (owner.ts || 0);
            if (owner.owner !== TAB_ID && age > HEARTBEAT_TIMEOUT) {
            console.log("[Tab " + TAB_ID + "] Owner stale, attempting takeover");
            clearOwnerInStorage();
            postMessageSafe({ type: "OWNER_STALE", tabId: owner.owner, ts: now() });
            tryAutoClaim();
            }
        }, HEARTBEAT_INTERVAL);

        // Cleanup
        window.addEventListener("pagehide", () => {
            if (isOwner) releaseOwnership();
        });
        
        window.addEventListener("beforeunload", () => {
            if (isOwner) releaseOwnership();
        });

        // ----- Initialize -----
        console.log("[Tab " + TAB_ID + "] Starting up");
        postMessageSafe({ type: "OPENED", tabId: TAB_ID, ts: now() });

        const existingOwner = getOwnerFromStorage();
        if (!existingOwner) {
            setTimeout(() => {
            const recheck = getOwnerFromStorage();
            if (!recheck) {
                claimOwnership();
            } else if (recheck.owner !== TAB_ID) {
                becomeNonOwner();
            }
            }, 80 + Math.random() * 150);
        } else {
            if (existingOwner.owner !== TAB_ID) {
            becomeNonOwner();
            } else {
            becomeOwner();
            }
        }

        // Debug API
        window.__appSession = {
            TAB_ID, 
            isOwner: () => isOwner, 
            claim: claimOwnership, 
            release: releaseOwnership,
            getOwner: getOwnerFromStorage
        };
        })();

        </script>


<script> -->

    /*
Inactivity Screensaver - Shows clock after 2 minutes of inactivity
Paste this script into your page (before </body>)
*/
/*
Inactivity Screensaver - Shows clock after 2 minutes of inactivity
Paste this script into your page (before </body>)
*/

(function() {
  // ----- Config -----
  const INACTIVITY_TIMEOUT = 12000; // 2 minutes (120000ms)
  
  // ----- State -----
  let inactivityTimer = null;
  let screensaverVisible = false;
  let lastActivity = Date.now();
  let clockInterval = null;

  function createScreensaver() {
    if (screensaverVisible) return;
    
    console.log("[Screensaver] Activating due to inactivity");
    screensaverVisible = true;

    if (!document.getElementById("screensaverStyle")) {
        const style = document.createElement("style");
        style.id = "screensaverStyle";
        style.innerHTML = `
        .screensaver-overlay {
            position: fixed;
            inset: 0;
            z-index: 2147483646;
            background: #0a0e27;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            animation: screensaver-fade 0.5s ease;
            cursor: pointer;
            overflow: hidden;
        }

        @keyframes screensaver-fade {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .screensaver-emoji {
            position: absolute;
            font-size: 80px;
            animation: bounce 3s ease-in-out infinite;
            user-select: none;
        }

            @keyframes bounce {
            0%, 100% {
                transform: translateY(0) rotate(0deg);
            }
            25% {
                transform: translateY(-30px) rotate(5deg);
            }
            50% {
                transform: translateY(0) rotate(0deg);
            }
            75% {
                transform: translateY(-15px) rotate(-5deg);
            }
            }

            .screensaver-clock {
                font-family: 'Courier New', monospace;
                font-size: 120px;
                font-weight: 700;
                color: #fff;
                letter-spacing: 8px;
                margin-top: 40px;
            }

            .screensaver-date {
            font-family: 'Segoe UI', Tahoma, sans-serif;
            font-size: 28px;
            font-weight: 300;
            color: rgba(255,255,255,0.7);
            margin-top: 20px;
            letter-spacing: 2px;
            }

            .screensaver-message {
            position: absolute;
            bottom: 60px;
            font-family: 'Segoe UI', Tahoma, sans-serif;
            font-size: 16px;
            color: rgba(255,255,255,0.5);
            letter-spacing: 1px;
            animation: message-pulse 3s ease-in-out infinite;
            }

            @keyframes message-pulse {
            0%, 100% { opacity: 0.5; }
            50% { opacity: 0.8; }
            }

            /* Responsive */
            @media (max-width: 768px) {
            .screensaver-clock {
                font-size: 72px;
                letter-spacing: 4px;
            }
            .screensaver-date {
                font-size: 20px;
            }
            .screensaver-message {
                font-size: 14px;
                bottom: 40px;
            }
            }

            @media (max-width: 480px) {
            .screensaver-clock {
                font-size: 56px;
                letter-spacing: 2px;
            }
            .screensaver-date {
                font-size: 18px;
            }
        }
      `;
      document.head.appendChild(style);
    }

    const overlay = document.createElement("div");
    overlay.className = "screensaver-overlay";
    overlay.id = "screensaver_overlay";

    const clockDiv = document.createElement("div");
    clockDiv.className = "screensaver-clock";
    clockDiv.id = "screensaver_clock";

    const dateDiv = document.createElement("div");
    dateDiv.className = "screensaver-date";
    dateDiv.id = "screensaver_date";

    const messageDiv = document.createElement("div");
    messageDiv.className = "screensaver-message";
    messageDiv.textContent = "Click anywhere or move mouse to continue";

    overlay.appendChild(clockDiv);
    overlay.appendChild(dateDiv);
    overlay.appendChild(messageDiv);

    document.body.appendChild(overlay);

    updateClock();
    clockInterval = setInterval(updateClock, 1000);

    // Click to dismiss
    overlay.addEventListener("click", removeScreensaver);
    overlay.addEventListener("mousemove", removeScreensaver);
    overlay.addEventListener("touchstart", removeScreensaver);
  }

  function updateClock() {
    const clockEl = document.getElementById("screensaver_clock");
    const dateEl = document.getElementById("screensaver_date");
    
    if (!clockEl || !dateEl) return;

    const now = new Date();
    
    const hours = String(now.getHours()).padStart(2, '0');
    const minutes = String(now.getMinutes()).padStart(2, '0');
    const seconds = String(now.getSeconds()).padStart(2, '0');
    clockEl.textContent = `${hours}:${minutes}:${seconds}`;

    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
    dateEl.textContent = now.toLocaleDateString('en-US', options);
  }

  function removeScreensaver() {
    if (!screensaverVisible) return;
    
    console.log("[Screensaver] Deactivating");
    screensaverVisible = false;

    const overlay = document.getElementById("screensaver_overlay");
    if (overlay) {
      overlay.remove();
    }

    if (clockInterval) {
      clearInterval(clockInterval);
      clockInterval = null;
    }

    // Reset inactivity timer
    resetInactivityTimer();
  }

  function resetInactivityTimer() {
    lastActivity = Date.now();
    
    if (inactivityTimer) {
      clearTimeout(inactivityTimer);
    }

    inactivityTimer = setTimeout(() => {
      console.log("[Screensaver] Inactivity detected");
      createScreensaver();
    }, INACTIVITY_TIMEOUT);
  }

    const activityEvents = [
        'mousedown', 
        'mousemove', 
        'keypress', 
        'scroll', 
        'touchstart',
        'click'
    ];

    let activityThrottle = null;
    function onActivity() {
        if (screensaverVisible) {
        removeScreensaver();
        return;
        }

        if (activityThrottle) return;
        
        activityThrottle = setTimeout(() => {
        activityThrottle = null;
        }, 1000); // Throttle to once per second

        resetInactivityTimer();
    }

    activityEvents.forEach(event => {
        document.addEventListener(event, onActivity, { passive: true });
    });

  console.log("[Screensaver] Initialized - will activate after 2 minutes of inactivity");
  resetInactivityTimer();

  // Expose API for manual control
    window.__screensaver = {
        show: createScreensaver,
        hide: removeScreensaver,
        isActive: () => screensaverVisible,
        resetTimer: resetInactivityTimer
    };
})();


</script>
</body>
</html>
